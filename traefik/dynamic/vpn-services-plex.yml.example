# Plex variant - copy this to vpn-services.yml if using docker-compose.plex-arr-stack.yml
# Changes from Jellyfin version: jellyfin→plex (port 32400), jellyseerr→overseerr
#
# REMOTE ACCESS (via Cloudflare Tunnel):
# - Plex, Overseerr - user-facing services
#
# LOCAL-ONLY (access via NAS_IP:PORT or .lan domains):
# - Sonarr, Radarr, Prowlarr, qBittorrent, Bazarr, Pi-hole
# - These have weak default auth ("Disabled for Local" / "Bypass localhost")
# - Use Overseerr for remote media requests instead

http:
  routers:
    plex:
      rule: "Host(`plex.yourdomain.com`)"
      entryPoints:
        - web
      service: plex

    overseerr:
      rule: "Host(`overseerr.yourdomain.com`)"
      entryPoints:
        - web
      service: overseerr

    # Optional: Redirect common typo (overseer -> overseerr)
    overseer-typo:
      rule: "Host(`overseer.yourdomain.com`)"
      entryPoints:
        - web
      middlewares:
        - overseer-redirect-external
      service: overseerr

  middlewares:
    overseer-redirect-external:
      redirectRegex:
        regex: "^https?://overseer[.](.+)"
        replacement: "https://overseerr.${1}"
        permanent: true

  services:
    plex:
      loadBalancer:
        servers:
          - url: "http://172.20.0.4:32400"

    overseerr:
      loadBalancer:
        servers:
          - url: "http://172.20.0.8:5055"
