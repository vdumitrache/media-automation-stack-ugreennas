# Local .lan domain routing (port-free access)
#
# How it works:
# 1. Pi-hole DNS resolves *.lan → TRAEFIK_LAN_IP (macvlan, e.g. 10.10.0.11)
# 2. Browser requests http://sonarr.lan → Traefik on port 80 (macvlan IP)
# 3. Traefik matches Host header → routes to correct service:port
#
# Result: http://sonarr.lan instead of http://10.10.0.10:8989
#
# Note: Requires Traefik macvlan setup (see docs/SETUP.md section 5.11)

http:
  routers:
    # === Media Services ===
    jellyfin-lan:
      rule: "Host(`jellyfin.lan`)"
      entryPoints: [web]
      service: jellyfin-lan

    jellyseerr-lan:
      rule: "Host(`jellyseerr.lan`)"
      entryPoints: [web]
      service: jellyseerr-lan

    # Typo redirects (jellyseer -> jellyseerr)
    jellyseer-lan:
      rule: "Host(`jellyseer.lan`)"
      entryPoints: [web]
      middlewares: [jellyseer-redirect]
      service: jellyseerr-lan

    # === *arr Stack (VPN-protected via Gluetun) ===
    sonarr-lan:
      rule: "Host(`sonarr.lan`)"
      entryPoints: [web]
      service: sonarr-lan

    radarr-lan:
      rule: "Host(`radarr.lan`)"
      entryPoints: [web]
      service: radarr-lan

    prowlarr-lan:
      rule: "Host(`prowlarr.lan`)"
      entryPoints: [web]
      service: prowlarr-lan

    bazarr-lan:
      rule: "Host(`bazarr.lan`)"
      entryPoints: [web]
      service: bazarr-lan

    # === Download Clients ===
    qbit-lan:
      rule: "Host(`qbit.lan`)"
      entryPoints: [web]
      service: qbit-lan

    sabnzbd-lan:
      rule: "Host(`sabnzbd.lan`)"
      entryPoints: [web]
      service: sabnzbd-lan

    # === Infrastructure ===
    traefik-lan:
      rule: "Host(`traefik.lan`)"
      entryPoints: [web]
      service: api@internal

    pihole-lan:
      rule: "Host(`pihole.lan`)"
      entryPoints: [web]
      service: pihole-lan

    wg-lan:
      rule: "Host(`wg.lan`)"
      entryPoints: [web]
      service: wg-lan

    # === Utilities ===
    uptime-lan:
      rule: "Host(`uptime.lan`)"
      entryPoints: [web]
      service: uptime-lan

    duc-lan:
      rule: "Host(`duc.lan`)"
      entryPoints: [web]
      service: duc-lan

    beszel-lan:
      rule: "Host(`beszel.lan`)"
      entryPoints: [web]
      service: beszel-lan

  middlewares:
    jellyseer-redirect:
      redirectRegex:
        regex: "^http://jellyseer[.]lan(.*)"
        replacement: "http://jellyseerr.lan${1}"
        permanent: true

  services:
    # === Media Services ===
    jellyfin-lan:
      loadBalancer:
        servers:
          - url: "http://172.20.0.4:8096"

    jellyseerr-lan:
      loadBalancer:
        servers:
          - url: "http://172.20.0.8:5055"

    # === *arr Stack (via Gluetun at 172.20.0.3) ===
    sonarr-lan:
      loadBalancer:
        servers:
          - url: "http://172.20.0.3:8989"

    radarr-lan:
      loadBalancer:
        servers:
          - url: "http://172.20.0.3:7878"

    prowlarr-lan:
      loadBalancer:
        servers:
          - url: "http://172.20.0.3:9696"

    bazarr-lan:
      loadBalancer:
        servers:
          - url: "http://172.20.0.9:6767"

    # === Download Clients (via Gluetun) ===
    qbit-lan:
      loadBalancer:
        servers:
          - url: "http://172.20.0.3:8085"

    sabnzbd-lan:
      loadBalancer:
        servers:
          - url: "http://172.20.0.3:8080"

    # === Infrastructure ===
    pihole-lan:
      loadBalancer:
        servers:
          - url: "http://172.20.0.5:80"

    wg-lan:
      loadBalancer:
        servers:
          - url: "http://172.20.0.6:51821"

    # === Utilities ===
    uptime-lan:
      loadBalancer:
        servers:
          - url: "http://172.20.0.13:3001"

    duc-lan:
      loadBalancer:
        servers:
          - url: "http://172.20.0.14:80"

    beszel-lan:
      loadBalancer:
        servers:
          - url: "http://172.20.0.15:8090"
